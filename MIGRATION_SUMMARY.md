# üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ PostgreSQL**
   - ‚ùå **–ë—ã–ª–æ**: MemStorage (–¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏, –ø—Ä–æ–ø–∞–¥–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)
   - ‚úÖ **–°—Ç–∞–ª–æ**: PostgreSQL (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞)

### 2. **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
   - `server/db.ts` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - `server/postgres-storage.ts` - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ PostgreSQL
   - –û–±–Ω–æ–≤–ª–µ–Ω `server/storage.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PostgreSQL

### 3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - ‚úÖ –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞: `scripts/backup-db.sh`
   - ‚úÖ –°–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: `scripts/restore-db.sh`
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
   - ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ: 7 –¥–Ω–µ–π, —Å—Ç–∞—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - `README_DATABASE.md` - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
   - `DATABASE.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - `MIGRATION_SUMMARY.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

```bash
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î: 2
‚úÖ –ê–≤—Ç–æ–±—ç–∫–∞–ø: –ù–∞—Å—Ç—Ä–æ–µ–Ω (3:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø: ./backups/cybershield_backup_20251001_155758.sql.gz
‚úÖ –°–µ—Ä–≤–µ—Ä: –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
```bash
# –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å testuser (ID: 1)
# –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å admin (ID: 2)
# –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ –ë–î ‚úÖ
```

### –¢–µ—Å—Ç 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
```sql
SELECT COUNT(*) FROM users;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –¢–µ—Å—Ç 3: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
```bash
./scripts/backup-db.sh
-- –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø: 3.2K
```

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
–¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è, –±—É–¥—É—Ç **—Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞**:

```bash
# –ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "myuser",
    "email": "user@example.com",
    "password": "MyPassword123!",
    "name": "My Name"
  }'
```

### –í—Ö–æ–¥
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "myuser",
    "password": "MyPassword123!"
  }'
```

## üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏

### –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é
```bash
cd /root/CyberShield
./scripts/backup-db.sh
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
ls -lh ./backups/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
./scripts/restore-db.sh ./backups/cybershield_backup_YYYYMMDD_HHMMSS.sql.gz
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø
–ù–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ cron:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
crontab -l | grep backup

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# 0 3 * * * cd /root/CyberShield && ./scripts/backup-db.sh >> /var/log/cybershield-backup.log 2>&1
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (bcrypt)
- ‚úÖ –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î (–Ω–µ –≤ –ø–∞–º—è—Ç–∏)
- ‚úÖ –ë–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å localhost
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
- ‚úÖ –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (>7 –¥–Ω–µ–π)

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. **–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–ø–∞–ª–∏?**
   - –î–∞, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å—Ç–∞—Ä–∞—è MemStorage –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞ –¥–∞–Ω–Ω—ã–µ
   - –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
   - –¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞!

2. **–ù—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ?**
   - –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –¥–∞–Ω–Ω—ã–µ –∏–∑ MemStorage –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å
   - –ù–∞—á–Ω–∏—Ç–µ —Å —á–∏—Å—Ç–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

3. **–ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –ï—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
     1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
     2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏
     3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL: `sudo systemctl status postgresql`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `pm2 logs cybershield`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î: `psql -h localhost -U pabit_user -d pabit_db`
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

## üìù –§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

- `server/db.ts` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- `server/postgres-storage.ts` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `DATABASE.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `README_DATABASE.md` - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

---

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**: 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (pabit_db)  
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: 2  
**–†–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π**: 1  

üéâ **–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!** üéâ


